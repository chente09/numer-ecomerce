<nz-card nzTitle="Administrar Categorías" class="mb-4">
    <button nz-button nzType="primary" (click)="openModal()">Nueva Categoría</button>
</nz-card>

<nz-table #tabla [nzData]="categories" [nzBordered]="true" [nzLoading]="loading" [nzShowPagination]="true"
    [nzPageSize]="5">
    <thead>
        <tr>
            <th>Imagen</th>
            <th>Nombre</th>
            <th>Descripción</th>
            <th>Slug</th>
            <th>Acciones</th>
        </tr>
    </thead>
    <tbody>
        @for (cat of tabla.data; track cat.id) {
        <tr>
            <td>
                <img [src]="cat.imageUrl" width="60" style="border-radius: 4px" />
            </td>
            <td>{{ cat.name }}</td>
            <td>{{ cat.description }}</td>
            <td>{{ cat.slug }}</td>
            <td>
                <button nz-button nzType="link" (click)="editCategory(cat)">Editar</button>
                <nz-popconfirm nzTitle="¿Seguro que quieres eliminar esta categoría?"
                    (nzOnConfirm)="deleteCategory(cat.id)" nzOkText="Sí" nzCancelText="No">
                    <button nz-button nzType="link" nzDanger>Eliminar</button>
                </nz-popconfirm>
                <button nz-button nzType="link" nzDanger nz-popconfirm
                    nzPopconfirmTitle="¿Seguro que quieres eliminar?" (nzOnConfirm)="deleteCategory(cat.id)">Eliminar
                </button>
            </td>
        </tr>
        }
    </tbody>
</nz-table>

<nz-modal [(nzVisible)]="modalVisible" [nzTitle]="isEditMode ? 'Editar Categoría' : 'Nueva Categoría'"
    [nzOkLoading]="saving" (nzOnCancel)="closeModal()" (nzOnOk)="handleSubmit()">
    <ng-container *nzModalContent>
        <form nz-form [nzLayout]="'vertical'">
            <nz-form-item>
                <nz-form-label>Nombre</nz-form-label>
                <nz-form-control>
                    <input nz-input [(ngModel)]="form.name" name="name" required placeholder="Ej. Escalada" />
                </nz-form-control>
            </nz-form-item>

            <nz-form-item>
                <nz-form-label>Descripción</nz-form-label>
                <nz-form-control>
                    <textarea nz-input [(ngModel)]="form.description" name="description" required
                        placeholder="Describe brevemente la categoría"></textarea>
                </nz-form-control>
            </nz-form-item>

            <nz-form-item>
                <nz-form-label>Slug</nz-form-label>
                <nz-form-control>
                    <input nz-input [(ngModel)]="form.slug" name="slug" required placeholder="Ej. escalada" />
                </nz-form-control>
            </nz-form-item>

            <nz-form-item>
                <nz-form-label>Imagen</nz-form-label>
                <nz-form-control>
                    <nz-upload [nzFileList]="fileList" [nzBeforeUpload]="beforeUpload"
                        [nzShowUploadList]="{ showPreviewIcon: true, showRemoveIcon: true }" [nzPreview]="handlePreview"
                        [nzRemove]="handleRemove" nzListType="picture-card">
                        <div *ngIf="fileList.length < 1">
                            <span nz-icon nzType="plus"></span>
                            <div class="ant-upload-text">Subir</div>
                        </div>
                    </nz-upload>
                    <div *ngIf="imageErrorMessage" style="color: red; margin-top: 8px;">
                        {{ imageErrorMessage }}
                    </div>
                </nz-form-control>
            </nz-form-item>
        </form>
    </ng-container>
</nz-modal>